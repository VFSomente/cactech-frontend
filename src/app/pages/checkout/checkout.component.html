<section class="checkout-page">
  <div class="checkout-container">
    <h2 class="checkout-title">Finalizar Compra</h2>

    <!-- =========================
         Produtos / Itens
         ========================= -->
    <div class="checkout-products" *ngIf="cartItems.length > 0">
      <h3>Itens no Carrinho</h3>

      <div *ngFor="let item of cartItems" class="checkout-item">
        <img [src]="item.image" alt="{{ item.name }}" />
        <div>
          <p>{{ item.name }}</p>
          <span>R$ {{ item.price | number: '1.2-2' }}</span>
        </div>
      </div>

      <div class="summary-details">
        <span>Valor Total:</span>
        <span>R$ {{ getTotalPrice() | number: '1.2-2' }}</span>
      </div>
    </div>

    <!-- =========================
         M√©todos de Pagamento
         ========================= -->
    <h3>M√©todo de Pagamento</h3>
    <div class="payment-methods">
      <div
        class="payment-method"
        [class.active]="selectedMethod === 'cartao'"
        (click)="selectMethod('cartao')"
      >
        üí≥ Cart√£o de Cr√©dito
      </div>

      <div
        class="payment-method"
        [class.active]="selectedMethod === 'boleto'"
        (click)="selectMethod('boleto')"
      >
        üßæ Boleto Banc√°rio
      </div>

      <div
        class="payment-method"
        [class.active]="selectedMethod === 'pix'"
        (click)="selectMethod('pix')"
      >
        üí∏ Pix
      </div>
    </div>

<!-- =========================
     Se√ß√£o Cart√£o (animado)
     ========================= -->
<div *ngIf="selectedMethod === 'cartao'">
  <div class="credit-card-container">
    <!-- .flipped ligado por isBackVisible -->
    <div class="credit-card" [class.flipped]="isBackVisible">
      
      <!-- Frente -->
      <div class="card-face card-front">
        <div class="card-header">
          <!-- Bandeira detectada (substitui o chip) -->
          <img
            *ngIf="cardBrand; else chipFallback"
            class="card-brand"
            [src]="'assets/images/payments/' + cardBrand + '.png'"
            [alt]="cardBrand"
          />
          <!-- Chip padr√£o (fallback se n√£o detectar bandeira) -->
          <ng-template #chipFallback>
            <div class="card-chip" aria-hidden="true"></div>
          </ng-template>
        </div>

        <!-- N√∫mero do cart√£o -->
        <div class="card-number">
          {{ cardNumber || '#### #### #### ####' }}
        </div>

        <!-- Nome e validade -->
        <div class="card-footer">
          <div class="card-holder">
            <span>Nome</span>
            <strong>{{ cardName || 'NOME COMPLETO' }}</strong>
          </div>

          <div class="card-expiration">
            <span>Validade</span>
            <strong>{{ cardExpiry || 'MM/AA' }}</strong>
          </div>
        </div>
      </div>

      <!-- Verso -->
      <div class="card-face card-back">
        <div class="magnetic-strip" aria-hidden="true"></div>
        <div class="cvv-box">{{ cardCvv || '***' }}</div>
      </div>
    </div>
  </div>

  <!-- =========================
       Formul√°rio do cart√£o
       ========================= -->
  <form class="card-form" (submit)="$event.preventDefault()">
    <label for="cardName">Nome no Cart√£o</label>
    <input
      id="cardName"
      type="text"
      placeholder="Ex: Victor Fernandes"
      (input)="updateName($event)"
    />

    <label for="cardNumber">N√∫mero do Cart√£o</label>
    <input
      id="cardNumber"
      type="text"
      maxlength="19"
      placeholder="1234 5678 9012 3456"
      (input)="updateNumber($event)"
    />

    <div class="card-row">
      <div class="card-field">
        <label for="cardExpiry">Validade</label>
        <input
          id="cardExpiry"
          type="text"
          maxlength="5"
          placeholder="MM/AA"
          (input)="updateExpiry($event)"
        />
      </div>

      <div class="card-field">
        <label for="cardCvv">CVV</label>
        <input
          id="cardCvv"
          type="text"
          maxlength="3"
          placeholder="123"
          (focus)="flipCard(true)"
          (blur)="flipCard(false)"
          (input)="updateCvv($event)"
        />
      </div>
    </div>
  </form>
</div>


    <!-- =========================
         Boleto
         ========================= -->
    <div *ngIf="selectedMethod === 'boleto'" class="boleto-section">
      <h3>Gerar Boleto Banc√°rio</h3>
      <p>O boleto ser√° v√°lido por 3 dias ap√≥s a emiss√£o.</p>
      <button class="boleto-btn" (click)="gerarBoleto()">Gerar Boleto</button>
    </div>

    <!-- =========================
         Pix
         ========================= -->
    <div *ngIf="selectedMethod === 'pix'" class="pix-section">
      <h3>Pagamento via Pix</h3>
      <p>Escaneie o QR Code ou copie o c√≥digo abaixo:</p>

      <div class="pix-code">
        {{
          pixCode ||
            '00020126580014BR.GOV.BCB.PIX0136pix@cactech.com520400005303986540512.345802BR5920CacTech LTDA6009SAO PAULO62100506ABC1236304ABCD'
        }}
      </div>

      <button class="copy-btn" (click)="copiarPix()">Copiar C√≥digo</button>
    </div>

    <!-- =========================
         Finalizar Compra (bot√£o)
         ========================= -->
    <button class="finalize-btn" (click)="finalizarCompra()">
      Finalizar Compra
    </button>
  </div>
</section>
